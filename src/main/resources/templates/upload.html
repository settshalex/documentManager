<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: header('Carica Documenti')}">
</head>
<body class="d-flex flex-column min-vh-100">
<div th:replace="~{fragments/navbar :: navbar}"></div>

<main class="container py-4">
  <!-- Il tuo contenuto esistente qui -->
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
          <h4 class="mb-0">Carica Nuovi Documenti</h4>
          <a th:href="@{/}" class="btn btn-light btn-sm">
            <i class="bi bi-arrow-left me-1"></i>Torna alla lista
          </a>
        </div>
        <div class="card-body p-4">
          <div th:if="${successMessage}" class="alert alert-success" role="alert">
            <i class="bi bi-check-circle me-2"></i>
            <span th:text="${successMessage}"></span>
          </div>

          <div th:if="${errorMessage}" class="alert alert-danger" role="alert">
            <i class="bi bi-exclamation-circle me-2"></i>
            <span th:text="${errorMessage}"></span>
          </div>

          <form th:action="@{/api/document/}" method="POST"
                enctype="multipart/form-data" class="needs-validation" novalidate>
            <div class="mb-3">
              <label for="title" class="form-label">Titolo Base *</label>
              <input type="text" class="form-control" id="title"
                     name="title" required>
            </div>

            <div class="mb-3">
              <label for="description" class="form-label">Descrizione</label>
              <textarea class="form-control" id="description"
                        name="description" rows="3"></textarea>
            </div>

            <div class="mb-4">
              <label class="form-label">File *</label>
              <div class="drop-zone rounded border-2 border-dashed p-4 text-center"
                   id="dropZone">
                <input type="file" id="files" name="file"
                       multiple class="d-none" required>
                <i class="bi bi-cloud-upload display-4"></i>
                <p class="mt-2">Trascina i file qui o
                  <span class="text-primary">clicca per selezionare</span>
                </p>
              </div>
              <div id="fileList" class="mt-2 small"></div>
            </div>

            <div class="d-grid">
              <button type="submit" class="btn btn-primary">
                <i class="bi bi-cloud-upload me-2"></i>Carica File
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</main>

<div th:replace="~{fragments/footer :: footer}"></div>

<!-- Scripts specifici della pagina -->
<script th:inline="javascript">
  document.addEventListener('DOMContentLoaded', function() {
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('files');
    const fileList = document.getElementById('fileList');

    dropZone.addEventListener('click', () => fileInput.click());

    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.classList.add('border-primary');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('border-primary');
    });

    dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone.classList.remove('border-primary');
      fileInput.files = e.dataTransfer.files;
      updateFileList();
    });

    fileInput.addEventListener('change', updateFileList);

    function updateFileList() {
      fileList.innerHTML = '';
      Array.from(fileInput.files).forEach(file => {
        const fileSize = (file.size / 1024).toFixed(2);
        fileList.innerHTML += `
                            <div class="text-muted">
                                <i class="bi bi-file-earmark me-1"></i>
                                ${file.name} (${fileSize} KB)
                            </div>`;
      });
    }
  });
</script>
</body>
</html>
